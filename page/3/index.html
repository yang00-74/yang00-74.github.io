<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>谈谈1974</title><meta name="author" content="nathan.yang"><meta name="copyright" content="nathan.yang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="谈谈1974">
<meta property="og:url" content="https://yang00-74.github.io/page/3/index.html">
<meta property="og:site_name" content="谈谈1974">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:author" content="nathan.yang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/drogan.jpg"><link rel="canonical" href="https://yang00-74.github.io/page/3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '谈谈1974',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-08-24 15:18:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background: transparent"><nav id="nav"><span id="blog-info"><a href="/" title="谈谈1974"><span class="site-name">谈谈1974</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">谈谈1974</h1></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/06/02/Redis-4/" title="Redis 6.0 源码阅读笔记(4)-String 数据类型源码分析">Redis 6.0 源码阅读笔记(4)-String 数据类型源码分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-06-02T07:39:09.000Z" title="发表于 2023-06-02 15:39:09">2023-06-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Redis/">Redis</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Redis/Redis-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">Redis 源码阅读笔记</a></span></div><div class="content">存储的结构在 redis 字符串对象 String 的介绍中，我们知道 redis 对于字符串的存储共有 3 种存储形式，其存储的内存结构如以下图片示例:

OBJ_ENCODING_INT： 保存的字符串长度小于 20，并且是可以解析为 long 类型的整数值，那么存储方式就是直接将 redisObject 的 ptr 指针指向这个整数值

OBJ_ENCODING_EMBSTR: 长度小于 44 （OBJ_ENCODING_EMBSTR_SIZE_LIMIT）的字符串将以简单动态字符串（SDS） 的形式存储在 redisObject 中，但是redisObject 对象头会和 SDS 对象连续存在一起

OBJ_ENCODING_RAW: 字符串以简单动态字符串（SDS） 的形式存储，redisObject 对象头和 SDS 对象在内存地址上一般是不连续的两块内存


数据存储源码分析数据存储过程
在 Redis 6.0 源码阅读笔记(1)-Redis 服务端启动及命令执行 中我们已经知道客户端保存字符串的 set 命令将会调用到 t_string.c#setCommand() 函 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/06/02/Redis-3/" title="Redis 6.0 源码阅读笔记(3)-概述 Redis 重要数据结构及其 6 种数据类型">Redis 6.0 源码阅读笔记(3)-概述 Redis 重要数据结构及其 6 种数据类型</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-06-02T07:39:04.000Z" title="发表于 2023-06-02 15:39:04">2023-06-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Redis/">Redis</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Redis/Redis-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">Redis 源码阅读笔记</a></span></div><div class="content">重要数据结构Redis 有许多重要的数据结构，其存储结构从外层往内层依次是 redisDb、dict、dictht、dictEntry

redisDb 默认情况下有16个，每个 redisDb 内部包含一个 dict 的数据结构，dict 内部包含 dictht 数组，数组个数为2，主要用于 hash 扩容使用。dictht 内部包含 dictEntry 的数组，dictEntry 其实就是 hash 表的一个 key-value 节点，如果冲突通过 链地址法 解决


redisServer数据结构 redisServer 是一个 redis 服务端的抽象，定义在 server.h 中。  redisServer  中的属性非常多，以下为节选的一部分，简单介绍下


hz: redis 定时任务触发的频率
*db: redisDb 数组，默认 16 个 redisDb
*commands: redis 支持的命令的字典
*el: redis 事件循环实例
runid[CONFIG_RUN_ID_SIZE+1]: 当前 redis 实例的 runid


12345678910111 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/30/Redis-2/" title="Redis 6.0 源码阅读笔记(2)-Redis 多线程原理">Redis 6.0 源码阅读笔记(2)-Redis 多线程原理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-30T09:07:58.000Z" title="发表于 2023-05-30 17:07:58">2023-05-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Redis/">Redis</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Redis/Redis-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">Redis 源码阅读笔记</a></span></div><div class="content">前言Redis 6.0 中一个重大的改变就是引入了多线程IO。我们都知道 Redis  基于内存操作，几乎不存在 CPU 成为瓶颈的情况， 它主要受限于内存和网络。从 Redis 自身角度来说，读写网络的 read&#x2F;write 系统调用占用了 Redis 执行期间大部分 CPU 时间，瓶颈其实主要在于网络的 IO 消耗。基于这种情况，Redis 优化的方向在于提高网络 IO 性能，而一个简单有效的方法就是使用多线程任务分摊 Redis 同步 IO 读写的负荷
Redis 多线程模型Redis 6.0 版本以前的线程模型为典型的 单 Reactor 单线程 ，但是其多线程模型却与标准的 单 Reactor 多线程 不太相同，区别在于 Redis 多线程模型不是把业务逻辑处理交给子线程，而是把对网络数据的读写交给子线程处理，业务逻辑仍然由主线程完成

Redis 多线程源码分析
上图为 Redis 多线程相关的流程图，该图根据 Redis 6.0 源码阅读笔记(1)-Redis 服务端启动及命令执行 示意图适当增减而来，读者如有不理解的地方可以前往查看原文。以下为  Redis  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/30/Redis-1/" title="Redis 6.0 源码阅读笔记(1)-Redis 服务端启动及命令执行">Redis 6.0 源码阅读笔记(1)-Redis 服务端启动及命令执行</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-30T08:57:00.000Z" title="发表于 2023-05-30 16:57:00">2023-05-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Redis/">Redis</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Redis/Redis-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">Redis 源码阅读笔记</a></span></div><div class="content">前言本文基于 Redis 6.0 版本 ，读者如有兴趣可以自行点击链接进入 github 下载源码。Redis 用 C语言编写，其源码中不乏几百行的方法，这会给习惯了面向对象编程的读者造成一定的阅读障碍，不过仔细看的话也是能看懂的。Redis 服务端启动及命令执行的大致流程如下图所示，下文将对流程进行代码分析

Redis 服务端启动流程Redis 服务端的启动也就是事件循环的建立过程，服务端启动的入口为 server.c#main() 函数

server.c#main() 函数很长，此处只截取几个重要的方法调用来分析


initServerConfig()初始化 server 端的各项配置，本文重点关注其中的 populateCommandTable() 函数，这个函数将 redis 各个命令对应的 redisCommand 结构体存入了 server 的数据结构内
loadServerConfig()载入配置文件，初始化服务端相关配置，比如在这一步会配置 redis 的监听端口
initServer()主要创建事件循环实例，设置服务端处理 socket 事件的处理函数及处理定时 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/29/Netty-4/" title="Netty源码分析(4)-SubReactor 读写数据流程解析">Netty源码分析(4)-SubReactor 读写数据流程解析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-29T14:12:30.000Z" title="发表于 2023-05-29 22:12:30">2023-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Netty 源码分析</a></span></div><div class="content">前言在 Netty源码分析(3)-服务端新建连接处理 的梳理中我们已经分析到新连接在 SubReactor 上的注册，众所周知，建立连接的目的是完成通信，而这个过程无非是将本地的数据发送到对端，或者接收对端的数据。因此本文将关注点聚集在 Netty 框架中业务数据的处理流程，整个分析过程分为了两部分：


读取数据的流程
写出数据的流程



读取数据的处理
事件循环 NioEventLoop 启动后会处在空循环中不断轮询事件，对于 IO 就绪的事件会交给 NioEventLoop#processSelectedKey() 方法处理，这个方法中根据事件的不同又有不同的操作。我们已经知道新连接在SubReactor上注册后会监听 SelectionKey.OP_READ事件，则此处进入了 Unsafe#read()接口方法的调用
12345678910111213141516171819202122232425262728293031323334private void processSelectedKey(SelectionKey k, AbstractNioChannel ch) & ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/29/Netty-3/" title="Netty源码分析(3)-服务端新建连接处理">Netty源码分析(3)-服务端新建连接处理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-29T14:12:23.000Z" title="发表于 2023-05-29 22:12:23">2023-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Netty 源码分析</a></span></div><div class="content">前言在 Netty源码分析(2)-服务端启动流程 分析 ServerSocketChannel 绑定监听端口流程的末尾，我们已经提到了在绑定操作完成后， Netty 会提交异步任务调用 pipeline.fireChannelActive() 通知 Channel 已经激活，从而回调处理器中的 channelActive() 方法，而在这个过程中服务端 Channel 监听的事件将被更新为 SelectionKey.OP_ACCEPT。因此本文将服务端新连接建立分为了两个步骤，其流程如图所示


监听事件 SelectionKey.OP_ACCEPT 的设置
MainReactor 建立的新连接在 SubReactor 上的注册



监听事件 SelectionKey.OP_ACCEPT 的设置
AbstractUnsafe#bind()在完成 ServerSocketChannel 绑定监听服务器端口后，此时 Channel 已经是 Active状态，则会提交一个通知 Channel 激活的异步任务到事件循环线程中
123456789101112131415161718192021 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/29/Netty-2/" title="Netty源码分析(2)-服务端启动流程">Netty源码分析(2)-服务端启动流程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-29T13:44:46.000Z" title="发表于 2023-05-29 21:44:46">2023-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Netty 源码分析</a></span></div><div class="content">服务端启动步骤一个 Netty 服务端配置启动代码如下，其大略的流程为以下几个步骤：


创建 NioEventLoopGroup 实例，这个类是 Netty 的 Reactor 线程池实现之一，其实际为 EventLoop 的容器，而 EventLoop 的主要职责是处理所有注册到本线程多路复用器 Selector 上的 Channel。代码中创建了两个 NioEventLoopGroup 实例，这是 主从 Reactor 多线程模式 的体现
创建 ServerBootstrap 实例，该类是 Netty 服务端的启动辅助类，提供一系列方法用于设置服务端启动相关的参数
ServerBootstrap 对象调用 group() 方法设置并绑定主从 Reactor 线程池
ServerBootstrap 对象调用 channel() 方法设置服务端 Channel 实例类型
ServerBootstrap 对象调用 handler() 方法设置服务端 MainReactor 线程池业务处理器
ServerBootstrap 对象调用带 child 前缀的方法设置服务端 SubReacto ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/29/Reactor/" title="Reactor 与 Proactor 线程模型详解">Reactor 与 Proactor 线程模型详解</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-29T13:26:54.000Z" title="发表于 2023-05-29 21:26:54">2023-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Web-%E5%9F%BA%E7%A1%80/">Web 基础</a></span></div><div class="content">Reactor 模式Reactor模式也叫 Dispatcher模式，其基于事件驱动处理模式，基本设计思想是I&#x2F;O 复用结合线程池。下图为事件驱动处理示意图，可以看到大致流程为服务端程序监听处理多路请求传入的事件，并将事件分派给请求对应的处理线程完成处理


Reactor 模式中有 2 个关键组件：

Reactor运行在一个单独的线程中，负责监听和分发事件，分发事件给适当的 Handler 来对 IO 请求做出反应
Handler将自身与事件绑定，实际执行 I&#x2F;O 要完成的事件。Reactor 通过调度适当的 Handler 来响应 I&#x2F;O 事件，执行非阻塞操作


根据 Reactor 的数量和处理事件的线程数量的不同，Reactor 模式有 3 种实现：


单 Reactor 单线程
单 Reactor 多线程
主从 Reactor 多线程


单 Reactor 单线程实现的示意图如下，其消息的处理流程可概括为以下几步：


Reactor 通过 select 监控连接上的所有事件，收到事件后通过 dispatch 将其分发
如果该事件是请求连 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/29/Netty-1/" title="Netty源码分析(1)-核心组件与架构">Netty源码分析(1)-核心组件与架构</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-29T13:21:41.000Z" title="发表于 2023-05-29 21:21:41">2023-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Netty 源码分析</a></span></div><div class="content">Netty 组件架构Netty 的事件驱动框架基于 主从 Reactor 多线程 实现，其工作处理的流程如下所示。根据功能的不同，Netty 的组件主要可分为两个部分，分别是 事件分发组件 和 业务处理组件

事件分发组件事件分发组件主要包含了  EventLoopGroup 和 Acceptor 两类，其中   EventLoopGroup  为事件循环组，负责事件的分发处理，Acceptor 则是服务端处理 accept 事件的处理器，负责将主事件循环组新建的连接注册到从事件循环组，起到连接的作用
事件循环组 EventLoopGroupEventLoopGroup 主要管理 EventLoop 的生命周期，内部维护了一组 EventLoop，每个 EventLoop 负责处理多个 Channel 上的事件，而一个 Channel 只对应于一个 EventLoop
事件循环组实例 NioEventLoopGroupNioEventLoopGroup 继承结构很深，各个关键属性分布在不同的父类中，比较重要的如下:


MultithreadEventLoopGroup:DEFAULT ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/05/29/Java-8-ConcurrentHashMap/" title="Java 8 ConcurrentHashMap 源码分析">Java 8 ConcurrentHashMap 源码分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-29T08:13:09.000Z" title="发表于 2023-05-29 16:13:09">2023-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Java-%E5%9F%BA%E7%A1%80/">Java 基础</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Java-%E5%9F%BA%E7%A1%80/Java-%E5%B9%B6%E5%8F%91/">Java 并发</a></span></div><div class="content">ConcurrentHashMap 的底层结构JDK 1.8 的 ConcurrentHashMap 底层数据结构与 HashMap 基本相同，二者在容量机制、Entry 的 hash 值计算及数组 index 下标定位等方面几乎完全一致，这部分读者如感兴趣可参考 Java 8 HashMap 详解
ConcurrentHashMap 的元素存储过程ConcurrentHashMap#putVal() 方法源码如下，从中可以看到其处理有以下几个关键步骤：


ConcurrentHashMap 不支持 null 键 null 值
调用 ConcurrentHashMap#spread() 方法重新计算当前 key 的 hash，核心是高低 16 位异或增大离散程度
将 volatile 变量 table 赋值暂存为 tab，for 循环进行元素存储的处理
首先判断底层数组是否已经初始化，如果没有则调用 ConcurrentHashMap#initTable() 方法先初始化数组
根据 key 的 hash 运算确定一个数组下标，调用 ConcurrentHashMap#tabAt()  ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">nathan.yang</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yang00-74"><i class="fab fa-github"></i><span>关注我</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome to nathan blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/22/OpenSIPS-1/" title="OpenSIPS 注册终端 30s 自动挂断问题">OpenSIPS 注册终端 30s 自动挂断问题</a><time datetime="2023-08-22T09:58:32.000Z" title="发表于 2023-08-22 17:58:32">2023-08-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/15/Spring-di/" title="SpringBoot 三级缓存解决循环依赖源码分析">SpringBoot 三级缓存解决循环依赖源码分析</a><time datetime="2023-06-15T06:10:48.000Z" title="发表于 2023-06-15 14:10:48">2023-06-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/12/Tomcat-2/" title="Tomcat 9.0 源码分析(2)-连接器 Connector 的启动">Tomcat 9.0 源码分析(2)-连接器 Connector 的启动</a><time datetime="2023-06-12T08:58:30.000Z" title="发表于 2023-06-12 16:58:30">2023-06-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/12/Tomcat-1/" title="Tomcat 9.0 源码分析(1)-结构组成与核心组件">Tomcat 9.0 源码分析(1)-结构组成与核心组件</a><time datetime="2023-06-12T08:45:46.000Z" title="发表于 2023-06-12 16:45:46">2023-06-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/09/Java-dynamic-proxy/" title="Java 动态代理的底层原理">Java 动态代理的底层原理</a><time datetime="2023-06-09T03:32:15.000Z" title="发表于 2023-06-09 11:32:15">2023-06-09</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java-%E5%9F%BA%E7%A1%80/"><span class="card-category-list-name">Java 基础</span><span class="card-category-list-count">6</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java-%E5%9F%BA%E7%A1%80/JVM/"><span class="card-category-list-name">JVM</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java-%E5%9F%BA%E7%A1%80/Java-%E5%B9%B6%E5%8F%91/"><span class="card-category-list-name">Java 并发</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><span class="card-category-list-name">Netty 源码分析</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OpenSIPS/"><span class="card-category-list-name">OpenSIPS</span><span class="card-category-list-count">1</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OpenSIPS/OpenSIPS-%E4%BD%BF%E7%94%A8%E5%A4%87%E5%BF%98/"><span class="card-category-list-name">OpenSIPS 使用备忘</span><span class="card-category-list-count">1</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Redis/"><span class="card-category-list-name">Redis</span><span class="card-category-list-count">15</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Redis/Redis-%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"><span class="card-category-list-name">Redis 源码阅读笔记</span><span class="card-category-list-count">13</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 1.16em; color: #999b9e">Git</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE/" style="font-size: 1.16em; color: #999b9e">工具配置</a> <a href="/tags/Java-%E5%9F%BA%E7%A1%80/" style="font-size: 1.33em; color: #99a2af">Java 基础</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.16em; color: #999b9e">多线程</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.39em; color: #99a4b4">数据结构</a> <a href="/tags/Spring/" style="font-size: 1.1em; color: #999">Spring</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.27em; color: #99a0a9">分布式</a> <a href="/tags/Tomcat/" style="font-size: 1.16em; color: #999b9e">Tomcat</a> <a href="/tags/Netty/" style="font-size: 1.21em; color: #999ea4">Netty</a> <a href="/tags/OpenSIPS/" style="font-size: 1.1em; color: #999">OpenSIPS</a> <a href="/tags/Java/" style="font-size: 1.44em; color: #99a7ba">Java</a> <a href="/tags/Redis/" style="font-size: 1.5em; color: #99a9bf">Redis</a> <a href="/tags/SIP-%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3/" style="font-size: 1.1em; color: #999">SIP 协议相关</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><span class="card-archive-list-count">21</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><span class="card-archive-list-count">11</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">33</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-08-24T07:18:21.224Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By nathan.yang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="点,啥,呢" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>